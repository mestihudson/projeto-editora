<?xml version="1.0" encoding="LATIN1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui">

<ui:composition template="/_template.xhtml">			
	<ui:define name="head">
	
	<div style="background: #EFF3FA; height: 24px; width: 95%" align="left">
		<h:outputText value="Venda > Efetuar Venda" styleClass="title" style="line-height: 20px;" />
		<div style="background: #C4D2EB; height: 2px;" />
	</div>
	</ui:define>

	<ui:define name="body">

		<div class="Centralizar" style="background: white;" align="center">
		
		<h:form rendered="#{loginBean.usuario.perfil.id>=3}">
		<div align="center">
		
			<br />		
			<p:graphicImage value="/resources/img/noacsses.png" />
			<br /><br /><br /><br />
			
			<a href="javascript:history.back(-1)">Voltar</a><br />

		
		</div>
		</h:form>	
		
			<h:form id="form_efetuar_venda" rendered="#{loginBean.usuario.perfil.id==1 or loginBean.usuario.perfil.id==2}">
			
			<p:focus context="pnl" for="prod" rendered="#{vendaBean.venda.operacao==1}" />
			
			<div style="background: #394674; align-top: center; height: 20px; line-height: 20px;" align="center" >
				
				<h:outputText value="EFETUAR VENDA" style="color: white; font-size: 12px;" styleClass="OutPut" />
								
				<p:selectOneRadio value="#{vendaBean.venda.operacao}" styleClass="OutPut" style="color: #8B0000;" rendered="#{loginBean.usuario.perfil.id==1 or loginBean.usuario.perfil.id==2}" 
					required="true" requiredMessage="Informe a operação">
						<f:selectItem itemLabel="Entrada" itemValue="1" />
						<f:selectItem itemLabel="Saída" itemValue="2" />
						<f:ajax render="form_efetuar_venda" />
					</p:selectOneRadio>
					
			</div>
			
			<fieldset style="border: 1px solid #6A6A6A; border-top: 0; border-bottom: 0px;">
			
			<h:panelGrid id="botton" columns="2" style="float: right;">
				<h:graphicImage value="/resources/img/estoque.png" onclick="dlgEstoque.show();" style="float: right; cursor: pointer;"
				styleClass="acende"	title="Verificar estoque" />		
			</h:panelGrid>		

			<br /><br /><br />
				
					<div style="float: left; margin-left: 10px">					
					<p:panel header="Dados da Venda" style="height: 130px; width: 450px;">
					
					<h:panelGrid id="grid" columns="5" cellspacing="5" cellpadding="5">
					<br /><br />
					
					<h:outputLabel value="Saída" styleClass="OutPut" rendered="#{empty vendaBean.venda.cliente.nome and vendaBean.venda.operacao == 2}" style="color: #8B0000;" />
					<h:outputLabel value="Cliente" styleClass="OutPut" rendered="#{empty vendaBean.venda.cliente.nome and vendaBean.venda.operacao == 1}" />
					<h:outputLabel value="Cliente: " styleClass="OutPut" rendered="#{not empty vendaBean.venda.cliente.nome and vendaBean.venda.operacao == 1}" />
					<h:graphicImage value="/resources/img/as.png" styleClass="as" rendered="#{empty vendaBean.venda.cliente.nome and vendaBean.venda.operacao == 1}" />
					<p:inputText id="cliente" value="#{vendaBean.venda.cliente.nome}" size="200" rendered="#{empty vendaBean.venda.cliente.nome and vendaBean.venda.operacao == 1}"
					required="true" requiredMessage="Informe o Cliente" styleClass="input" onclick="dlgCliente.show();" readonly="true">
							<f:ajax event="change" />
					</p:inputText>
					
					<h:outputLabel id="cliente1" value="#{vendaBean.venda.cliente.id} - " rendered="#{not empty vendaBean.venda.cliente.nome and vendaBean.venda.cliente.id != 1 and vendaBean.venda.operacao != 2}"
					styleClass="OutPut" style="color: #8B0000;">
					</h:outputLabel>
					
					<h:outputLabel id="cliente2" value="#{vendaBean.venda.cliente.nome}" rendered="#{not empty vendaBean.venda.cliente.nome and vendaBean.venda.cliente.id != 1 and vendaBean.venda.operacao != 2}"
					styleClass="OutPut" style="color: #8B0000;">
					</h:outputLabel>
					
					<h:outputLabel id="cliente3" value="#{vendaBean.venda.cliente.nome}" rendered="#{not empty vendaBean.venda.cliente.nome and vendaBean.venda.cliente.id == 1 and vendaBean.venda.operacao != 2}"
					styleClass="OutPut" style="color: red;">
					</h:outputLabel>
					
					</h:panelGrid>
					<br /><br /><br />
														
					<h:outputLabel id="datavenda" value="#{vendaBean.venda.dataVenda.time}" locale="pt_BR" pattern="dd/MM/yyyy" 
					style="float: right; text-align: right;" styleClass="OutPut">
						<f:convertDateTime dateStyle="long" timeZone="America/Sao_Paulo" locale="pt_BR" type="date" />
					</h:outputLabel>
					<br /><br />
					
					</p:panel>
					</div>
										
					<div style="float: right; text-align: left; margin-right: 10px">
					<p:panel header="Estou ciente" style="height: 130px; width: 550px; text-align: left" rendered="#{vendaBean.venda.operacao == 2}">
					<br />
					
					<h:outputLabel value="Eu, #{loginBean.usuario.nome}" style="font-weight: bold; color:#8B0000; font-size: 14px;" 
					styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 2}" /><br /><br />
					<h:outputLabel value="tenho total conhecimento que estou" style="font-weight: bold; color:#8B0000; font-size: 14px;" 
					styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 2}" /><br /><br />
					<h:outputLabel value="retirando do caixa o valor especificado abaixo." style="font-weight: bold; color:#8B0000; font-size: 14px;" 
					styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 2}" />
										
					</p:panel>
					</div>
					
<!-- 					panel add produto -->
					<div style="float: right; margin-right: 10px">
					<p:panel header="Produto" style="height: 130px; width: 550px;" rendered="#{vendaBean.venda.operacao != 2}" id="pnl">
					
					<h:panelGrid columns="3" cellpadding="5" cellspacing="5">
					
<!--            		aqui a lista retorna o primeiro id depois que muda o value -->

					<h:outputLabel value="isbn/código" styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 1}" />   
            		<p:selectOneMenu style="width: 400px;" id="prod" value="#{vendaBean.idItem}"
            		filter="true" filterMatchMode="startsWith"
					styleClass="input" panelStyle="width:400px" rendered="#{vendaBean.venda.operacao == 1}"
					effect="fade" required="true" requiredMessage="Adicione o produto">
						<f:selectItem itemValue="" itemLabel="" noSelectionOption="true" />
						<f:selectItems value="#{itemBean.estoque}" var="i" itemLabel="#{i.produto.isbn}" itemValue="#{i.id}" id="filter" />
<!-- 						<f:selectItems value="#{itemBean.estoque}" var="i" itemLabel="#{i.produto.isbn} - LOTE: #{i.notaFiscal.lote}" itemValue="#{i.id}" id="filter" />             			            		 -->
            		</p:selectOneMenu>
            		            		
            		<!--             		<p:autoComplete style="width: 400px;" id="prod" value="#{vendaBean.idItem}" maxlength="13" -->
<!-- 					styleClass="input" rendered="#{vendaBean.venda.operacao == 1}" -->
<!-- 					required="true" requiredMessage="Adicione o produto" converter="genericConverter">           			            		            			            		 -->
<!--             		</p:autoComplete> -->
            		
<!--             		// agora só precisa fazer a conversão! -->
            		
            		<br /><br />
            		
            		<h:outputLabel value="Quantidade" styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 1}" />
					<p:inputText id="qtd" value="#{vendaBean.itemVenda.quantidade}" size="5"
					validatorMessage="Quantidade inválida" rendered="#{vendaBean.venda.operacao == 1}">
						<f:ajax event="blur" />
						<f:validateLongRange minimum="0" maximum="100" />
					</p:inputText>
					
					</h:panelGrid>
            		
            		<div>					
					<p:commandButton value="Adicionar" action="#{vendaBean.guardaItem}" ajax="false" rendered="#{vendaBean.venda.operacao == 1}">
						<f:ajax render="@form" event="click" /> 
					</p:commandButton>
					</div>
					
					</p:panel>
					</div>
				
<!-- 				aqui começa a tabela de produtos -->
				<br />
				<div style="float: center">
				<br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br />
					<div style="background: #A6C9E2; align-top: center; margin-left: 10px; margin-right: 10px; height: 20px; line-height: 20px;" align="center">
					<h:outputText value="PRODUTOS" style="color: #394674; font-size: 12px;" styleClass="OutPut" rendered="#{vendaBean.venda.operacao != 2}" />
					</div>
				
				<fieldset style="border-color: #A6C9E2; margin-left: 10px; margin-right: 10px; border: 1px solid #A6C9E2; border-top: 0;" >
				
					<p:dataTable value="#{vendaBean.venda.itensVendas}" var="i" styleClass="dados2" rowClasses="impar, par" id="itens"
					rowStyleClass="#{empty rowIx or rowIx mod 2 ne 0 ? 'even-row' : 'odd-row'}" rowIndexVar="rowIx"
					emptyMessage="adicione o(s) produto()" rendered="#{vendaBean.venda.operacao != 2}">
					        				
        				<p:column width="50" style="font-weight: bold;">
							<f:facet name="header">isbn/código</f:facet>
							<h:outputLabel value="#{i.item.produto.isbn}" rendered="#{i.item.produto.isbn!=null}" />
							<h:outputLabel value="#{i.item.produto.id}" rendered="#{i.item.produto.isbn==null}" />
						</p:column>

						<p:column style="font-weight: bold;">
							<f:facet name="header">produto</f:facet>
							<h:outputLabel value="#{i.item.produto.tipo.nome}: " rendered="#{i.item.produto.tipo.id eq 1}" />
							<h:outputLabel value="#{i.item.produto.nome}">
								<f:converter converterId="stringLimiterConverter" />
								<f:attribute name="limit" value="50" />
							</h:outputLabel>
						</p:column>
						
						<p:column width="50" style="color: #2E6EAF; text-align: center;">
							<f:facet name="header">lote</f:facet>
							<h:outputLabel value="#{i.item.notaFiscal.lote}" />
						</p:column>
						
						<p:column style="text-align: center; color: #2E6EAF" width="100">
							<f:facet name="header">qtd atual em estoq.</f:facet>
							<h:outputLabel value="#{i.item.quantidadeAtual-i.quantidade}" rendered="#{i.item.quantidadeAtual-i.quantidade>=1}" />
							<h:outputLabel value="sem estoque" rendered="#{i.item.quantidadeAtual-i.quantidade==0}" style="color: #8B0000;" />
							<h:outputLabel value="quantidade indisponível !" rendered="#{vendaBean.quantidadeN == true}" style="color: red;" /> 
							<h:outputLabel value="quantidade indisponível !" rendered="#{vendaBean.quantidadeN == null 
							and i.item.quantidadeAtual-i.quantidade!=0 and i.item.quantidadeAtual-i.quantidade!=1 and i.item.quantidadeAtual-i.quantidade!=2 and i.item.quantidadeAtual-i.quantidade!=3	and i.item.quantidadeAtual-i.quantidade!=4 and i.item.quantidadeAtual-i.quantidade!=5 and i.item.quantidadeAtual-i.quantidade!=6 and i.item.quantidadeAtual-i.quantidade!=7	and i.item.quantidadeAtual-i.quantidade!=8 and i.item.quantidadeAtual-i.quantidade!=9 and i.item.quantidadeAtual-i.quantidade!=10 and i.item.quantidadeAtual-i.quantidade!=11	and i.item.quantidadeAtual-i.quantidade!=12	and i.item.quantidadeAtual-i.quantidade!=13	and i.item.quantidadeAtual-i.quantidade!=14	and i.item.quantidadeAtual-i.quantidade!=15	and i.item.quantidadeAtual-i.quantidade!=16	and i.item.quantidadeAtual-i.quantidade!=17	and i.item.quantidadeAtual-i.quantidade!=18	and i.item.quantidadeAtual-i.quantidade!=19	and i.item.quantidadeAtual-i.quantidade!=20	and i.item.quantidadeAtual-i.quantidade!=21 and i.item.quantidadeAtual-i.quantidade!=22 and i.item.quantidadeAtual-i.quantidade!=23	and i.item.quantidadeAtual-i.quantidade!=24	and i.item.quantidadeAtual-i.quantidade!=25 and i.item.quantidadeAtual-i.quantidade!=26 and i.item.quantidadeAtual-i.quantidade!=27	and i.item.quantidadeAtual-i.quantidade!=28	and i.item.quantidadeAtual-i.quantidade!=29 and i.item.quantidadeAtual-i.quantidade!=30 and i.item.quantidadeAtual-i.quantidade!=31	and i.item.quantidadeAtual-i.quantidade!=32	and i.item.quantidadeAtual-i.quantidade!=33	and i.item.quantidadeAtual-i.quantidade!=34	and i.item.quantidadeAtual-i.quantidade!=35 and i.item.quantidadeAtual-i.quantidade!=36	and i.item.quantidadeAtual-i.quantidade!=37	and i.item.quantidadeAtual-i.quantidade!=38	and i.item.quantidadeAtual-i.quantidade!=39 and i.item.quantidadeAtual-i.quantidade!=40 and i.item.quantidadeAtual-i.quantidade!=41 and i.item.quantidadeAtual-i.quantidade!=42 and i.item.quantidadeAtual-i.quantidade!=43	and i.item.quantidadeAtual-i.quantidade!=44	and i.item.quantidadeAtual-i.quantidade!=45 and i.item.quantidadeAtual-i.quantidade!=46 and i.item.quantidadeAtual-i.quantidade!=47 and i.item.quantidadeAtual-i.quantidade!=48	and i.item.quantidadeAtual-i.quantidade!=49 and i.item.quantidadeAtual-i.quantidade!=50
						    and i.item.quantidadeAtual-i.quantidade!=51 and i.item.quantidadeAtual-i.quantidade!=52 and i.item.quantidadeAtual-i.quantidade!=53 and i.item.quantidadeAtual-i.quantidade!=54	and i.item.quantidadeAtual-i.quantidade!=55 and i.item.quantidadeAtual-i.quantidade!=56 and i.item.quantidadeAtual-i.quantidade!=57 and i.item.quantidadeAtual-i.quantidade!=58	and i.item.quantidadeAtual-i.quantidade!=59 and i.item.quantidadeAtual-i.quantidade!=60	and i.item.quantidadeAtual-i.quantidade!=61	and i.item.quantidadeAtual-i.quantidade!=62	and i.item.quantidadeAtual-i.quantidade!=63	and i.item.quantidadeAtual-i.quantidade!=64	and i.item.quantidadeAtual-i.quantidade!=65	and i.item.quantidadeAtual-i.quantidade!=66	and i.item.quantidadeAtual-i.quantidade!=67	and i.item.quantidadeAtual-i.quantidade!=68	and i.item.quantidadeAtual-i.quantidade!=69	and i.item.quantidadeAtual-i.quantidade!=70	and i.item.quantidadeAtual-i.quantidade!=71 and i.item.quantidadeAtual-i.quantidade!=72 and i.item.quantidadeAtual-i.quantidade!=73	and i.item.quantidadeAtual-i.quantidade!=74	and i.item.quantidadeAtual-i.quantidade!=75 and i.item.quantidadeAtual-i.quantidade!=76 and i.item.quantidadeAtual-i.quantidade!=77	and i.item.quantidadeAtual-i.quantidade!=78	and i.item.quantidadeAtual-i.quantidade!=79 and i.item.quantidadeAtual-i.quantidade!=80 and i.item.quantidadeAtual-i.quantidade!=81	and i.item.quantidadeAtual-i.quantidade!=82	and i.item.quantidadeAtual-i.quantidade!=83	and i.item.quantidadeAtual-i.quantidade!=84	and i.item.quantidadeAtual-i.quantidade!=85 and i.item.quantidadeAtual-i.quantidade!=86	and i.item.quantidadeAtual-i.quantidade!=87	and i.item.quantidadeAtual-i.quantidade!=88	and i.item.quantidadeAtual-i.quantidade!=89 and i.item.quantidadeAtual-i.quantidade!=90 and i.item.quantidadeAtual-i.quantidade!=91 and i.item.quantidadeAtual-i.quantidade!=92 and i.item.quantidadeAtual-i.quantidade!=93	and i.item.quantidadeAtual-i.quantidade!=94	and i.item.quantidadeAtual-i.quantidade!=95 and i.item.quantidadeAtual-i.quantidade!=96 and i.item.quantidadeAtual-i.quantidade!=97 and i.item.quantidadeAtual-i.quantidade!=98	and i.item.quantidadeAtual-i.quantidade!=99 and i.item.quantidadeAtual-i.quantidade!=100
						    and i.item.quantidadeAtual-i.quantidade!=101 and i.item.quantidadeAtual-i.quantidade!=102 and i.item.quantidadeAtual-i.quantidade!=103 and i.item.quantidadeAtual-i.quantidade!=104	and i.item.quantidadeAtual-i.quantidade!=105 and i.item.quantidadeAtual-i.quantidade!=106 and i.item.quantidadeAtual-i.quantidade!=107 and i.item.quantidadeAtual-i.quantidade!=108	and i.item.quantidadeAtual-i.quantidade!=109 and i.item.quantidadeAtual-i.quantidade!=110 and i.item.quantidadeAtual-i.quantidade!=111	and i.item.quantidadeAtual-i.quantidade!=112 and i.item.quantidadeAtual-i.quantidade!=113 and i.item.quantidadeAtual-i.quantidade!=114 and i.item.quantidadeAtual-i.quantidade!=115	and i.item.quantidadeAtual-i.quantidade!=116 and i.item.quantidadeAtual-i.quantidade!=117 and i.item.quantidadeAtual-i.quantidade!=118 and i.item.quantidadeAtual-i.quantidade!=119	and i.item.quantidadeAtual-i.quantidade!=120 and i.item.quantidadeAtual-i.quantidade!=121 and i.item.quantidadeAtual-i.quantidade!=122 and i.item.quantidadeAtual-i.quantidade!=123	and i.item.quantidadeAtual-i.quantidade!=124 and i.item.quantidadeAtual-i.quantidade!=125 and i.item.quantidadeAtual-i.quantidade!=126 and i.item.quantidadeAtual-i.quantidade!=127	and i.item.quantidadeAtual-i.quantidade!=128 and i.item.quantidadeAtual-i.quantidade!=129 and i.item.quantidadeAtual-i.quantidade!=130 and i.item.quantidadeAtual-i.quantidade!=131	and i.item.quantidadeAtual-i.quantidade!=132 and i.item.quantidadeAtual-i.quantidade!=133 and i.item.quantidadeAtual-i.quantidade!=134 and i.item.quantidadeAtual-i.quantidade!=135 and i.item.quantidadeAtual-i.quantidade!=136 and i.item.quantidadeAtual-i.quantidade!=137 and i.item.quantidadeAtual-i.quantidade!=138	and i.item.quantidadeAtual-i.quantidade!=139 and i.item.quantidadeAtual-i.quantidade!=140 and i.item.quantidadeAtual-i.quantidade!=141 and i.item.quantidadeAtual-i.quantidade!=142 and i.item.quantidadeAtual-i.quantidade!=143 and i.item.quantidadeAtual-i.quantidade!=144 and i.item.quantidadeAtual-i.quantidade!=145 and i.item.quantidadeAtual-i.quantidade!=146 and i.item.quantidadeAtual-i.quantidade!=147 and i.item.quantidadeAtual-i.quantidade!=148 and i.item.quantidadeAtual-i.quantidade!=149 and i.item.quantidadeAtual-i.quantidade!=150
						    and i.item.quantidadeAtual-i.quantidade!=151 and i.item.quantidadeAtual-i.quantidade!=152 and i.item.quantidadeAtual-i.quantidade!=153 and i.item.quantidadeAtual-i.quantidade!=154	and i.item.quantidadeAtual-i.quantidade!=155 and i.item.quantidadeAtual-i.quantidade!=156 and i.item.quantidadeAtual-i.quantidade!=157 and i.item.quantidadeAtual-i.quantidade!=158	and i.item.quantidadeAtual-i.quantidade!=159 and i.item.quantidadeAtual-i.quantidade!=160 and i.item.quantidadeAtual-i.quantidade!=161	and i.item.quantidadeAtual-i.quantidade!=162 and i.item.quantidadeAtual-i.quantidade!=163 and i.item.quantidadeAtual-i.quantidade!=164 and i.item.quantidadeAtual-i.quantidade!=165	and i.item.quantidadeAtual-i.quantidade!=166 and i.item.quantidadeAtual-i.quantidade!=167 and i.item.quantidadeAtual-i.quantidade!=168 and i.item.quantidadeAtual-i.quantidade!=169	and i.item.quantidadeAtual-i.quantidade!=170 and i.item.quantidadeAtual-i.quantidade!=171 and i.item.quantidadeAtual-i.quantidade!=172 and i.item.quantidadeAtual-i.quantidade!=173	and i.item.quantidadeAtual-i.quantidade!=174 and i.item.quantidadeAtual-i.quantidade!=175 and i.item.quantidadeAtual-i.quantidade!=176 and i.item.quantidadeAtual-i.quantidade!=177	and i.item.quantidadeAtual-i.quantidade!=178 and i.item.quantidadeAtual-i.quantidade!=179 and i.item.quantidadeAtual-i.quantidade!=180 and i.item.quantidadeAtual-i.quantidade!=181	and i.item.quantidadeAtual-i.quantidade!=182 and i.item.quantidadeAtual-i.quantidade!=183 and i.item.quantidadeAtual-i.quantidade!=184 and i.item.quantidadeAtual-i.quantidade!=185 and i.item.quantidadeAtual-i.quantidade!=186 and i.item.quantidadeAtual-i.quantidade!=187 and i.item.quantidadeAtual-i.quantidade!=188	and i.item.quantidadeAtual-i.quantidade!=189 and i.item.quantidadeAtual-i.quantidade!=190 and i.item.quantidadeAtual-i.quantidade!=191 and i.item.quantidadeAtual-i.quantidade!=192 and i.item.quantidadeAtual-i.quantidade!=193 and i.item.quantidadeAtual-i.quantidade!=194 and i.item.quantidadeAtual-i.quantidade!=195 and i.item.quantidadeAtual-i.quantidade!=196 and i.item.quantidadeAtual-i.quantidade!=197 and i.item.quantidadeAtual-i.quantidade!=198 and i.item.quantidadeAtual-i.quantidade!=199 and i.item.quantidadeAtual-i.quantidade!=200
						    and i.item.quantidadeAtual-i.quantidade!=201 and i.item.quantidadeAtual-i.quantidade!=202 and i.item.quantidadeAtual-i.quantidade!=203 and i.item.quantidadeAtual-i.quantidade!=204	and i.item.quantidadeAtual-i.quantidade!=205 and i.item.quantidadeAtual-i.quantidade!=206 and i.item.quantidadeAtual-i.quantidade!=207 and i.item.quantidadeAtual-i.quantidade!=208	and i.item.quantidadeAtual-i.quantidade!=209 and i.item.quantidadeAtual-i.quantidade!=210 and i.item.quantidadeAtual-i.quantidade!=211	and i.item.quantidadeAtual-i.quantidade!=212 and i.item.quantidadeAtual-i.quantidade!=213 and i.item.quantidadeAtual-i.quantidade!=214 and i.item.quantidadeAtual-i.quantidade!=215	and i.item.quantidadeAtual-i.quantidade!=216 and i.item.quantidadeAtual-i.quantidade!=217 and i.item.quantidadeAtual-i.quantidade!=218 and i.item.quantidadeAtual-i.quantidade!=219	and i.item.quantidadeAtual-i.quantidade!=220 and i.item.quantidadeAtual-i.quantidade!=221 and i.item.quantidadeAtual-i.quantidade!=222 and i.item.quantidadeAtual-i.quantidade!=223	and i.item.quantidadeAtual-i.quantidade!=224 and i.item.quantidadeAtual-i.quantidade!=225 and i.item.quantidadeAtual-i.quantidade!=226 and i.item.quantidadeAtual-i.quantidade!=227	and i.item.quantidadeAtual-i.quantidade!=228 and i.item.quantidadeAtual-i.quantidade!=229 and i.item.quantidadeAtual-i.quantidade!=230 and i.item.quantidadeAtual-i.quantidade!=231	and i.item.quantidadeAtual-i.quantidade!=232 and i.item.quantidadeAtual-i.quantidade!=233 and i.item.quantidadeAtual-i.quantidade!=234 and i.item.quantidadeAtual-i.quantidade!=235 and i.item.quantidadeAtual-i.quantidade!=236 and i.item.quantidadeAtual-i.quantidade!=237 and i.item.quantidadeAtual-i.quantidade!=238	and i.item.quantidadeAtual-i.quantidade!=239 and i.item.quantidadeAtual-i.quantidade!=240 and i.item.quantidadeAtual-i.quantidade!=241 and i.item.quantidadeAtual-i.quantidade!=242 and i.item.quantidadeAtual-i.quantidade!=243 and i.item.quantidadeAtual-i.quantidade!=244 and i.item.quantidadeAtual-i.quantidade!=245 and i.item.quantidadeAtual-i.quantidade!=246 and i.item.quantidadeAtual-i.quantidade!=247 and i.item.quantidadeAtual-i.quantidade!=248 and i.item.quantidadeAtual-i.quantidade!=249 and i.item.quantidadeAtual-i.quantidade!=250
						    and i.item.quantidadeAtual-i.quantidade!=251 and i.item.quantidadeAtual-i.quantidade!=252 and i.item.quantidadeAtual-i.quantidade!=253 and i.item.quantidadeAtual-i.quantidade!=254	and i.item.quantidadeAtual-i.quantidade!=255 and i.item.quantidadeAtual-i.quantidade!=256 and i.item.quantidadeAtual-i.quantidade!=257 and i.item.quantidadeAtual-i.quantidade!=258	and i.item.quantidadeAtual-i.quantidade!=259 and i.item.quantidadeAtual-i.quantidade!=260 and i.item.quantidadeAtual-i.quantidade!=261	and i.item.quantidadeAtual-i.quantidade!=262 and i.item.quantidadeAtual-i.quantidade!=263 and i.item.quantidadeAtual-i.quantidade!=264 and i.item.quantidadeAtual-i.quantidade!=265	and i.item.quantidadeAtual-i.quantidade!=266 and i.item.quantidadeAtual-i.quantidade!=267 and i.item.quantidadeAtual-i.quantidade!=268 and i.item.quantidadeAtual-i.quantidade!=269	and i.item.quantidadeAtual-i.quantidade!=270 and i.item.quantidadeAtual-i.quantidade!=271 and i.item.quantidadeAtual-i.quantidade!=272 and i.item.quantidadeAtual-i.quantidade!=273	and i.item.quantidadeAtual-i.quantidade!=274 and i.item.quantidadeAtual-i.quantidade!=275 and i.item.quantidadeAtual-i.quantidade!=276 and i.item.quantidadeAtual-i.quantidade!=277	and i.item.quantidadeAtual-i.quantidade!=278 and i.item.quantidadeAtual-i.quantidade!=279 and i.item.quantidadeAtual-i.quantidade!=280 and i.item.quantidadeAtual-i.quantidade!=281	and i.item.quantidadeAtual-i.quantidade!=282 and i.item.quantidadeAtual-i.quantidade!=283 and i.item.quantidadeAtual-i.quantidade!=284 and i.item.quantidadeAtual-i.quantidade!=285 and i.item.quantidadeAtual-i.quantidade!=286 and i.item.quantidadeAtual-i.quantidade!=287 and i.item.quantidadeAtual-i.quantidade!=288	and i.item.quantidadeAtual-i.quantidade!=289 and i.item.quantidadeAtual-i.quantidade!=290 and i.item.quantidadeAtual-i.quantidade!=291 and i.item.quantidadeAtual-i.quantidade!=292 and i.item.quantidadeAtual-i.quantidade!=293 and i.item.quantidadeAtual-i.quantidade!=294 and i.item.quantidadeAtual-i.quantidade!=295 and i.item.quantidadeAtual-i.quantidade!=296 and i.item.quantidadeAtual-i.quantidade!=297 and i.item.quantidadeAtual-i.quantidade!=298 and i.item.quantidadeAtual-i.quantidade!=299 and i.item.quantidadeAtual-i.quantidade!=300}" style="color: red;" />
<!-- 						    continuar... faltam 200  -->
						</p:column>
						
						<p:column style="text-align: center; font-weight: bold;" width="15">
							<f:facet name="header">qtd</f:facet>
							<h:outputLabel value="#{i.quantidade}" />
						</p:column>	
						
						<p:column width="50" style="font-weight: bold;">
							<f:facet name="header">valor unit.</f:facet>
							<h:outputLabel value="#{i.item.valorVenda}">
								<f:convertNumber type="currency" currencySymbol="R$" locale="pt_BR" />
							</h:outputLabel>
						</p:column>
						
						<p:column width="50" style="text-align: center; font-weight: bold;">
							<f:facet name="header">sub total</f:facet>
							<h:outputText value="#{i.total}">
							<f:convertNumber type="currency" currencySymbol="R$"
								locale="pt_BR" />
							</h:outputText>
						</p:column>	
												
						<p:column style="text-align: center;" width="15">

						<p:commandLink action="#{vendaBean.removeItemVenda}" ajax="false"
							style="text-align: center; float: center;"
							update=":form_efetuar_venda:itens" immediate="true">
							<p:graphicImage value="/resources/img/remover.png" title="Remover item" />
							<f:ajax render="@all" />
							<f:setPropertyActionListener id="parametro"
								target="#{vendaBean.itemVenda}" value="#{i}" />
						</p:commandLink>

						</p:column>

							<p:columnGroup type="footer">
								<p:row>
									<p:column colspan="6" footerText="Valor Total"
										style="text-align:right; font-size: 14px;" />

									<p:column style="font-size: 14px;">
										<f:facet name="footer">
										<h:outputText value="#{vendaBean.valorTotalProdutos}">
											<f:convertNumber type="currency" currencySymbol="R$" locale="pt_BR" />
										</h:outputText>
										</f:facet>
									</p:column>
									
									<p:column headerText="" />

								</p:row>
							</p:columnGroup>

						</p:dataTable>
						
						</fieldset>
						
						<div style="background: #A6C9E2; align-top: center; margin-left: 10px; margin-right: 10px; height: 20px; line-height: 20px;"
							align="center">
							<h:outputText style="color: #394674; font-size: 12px;"
								styleClass="OutPut" />
						</div>
						</div>
						<br />
						
<!-- 						aqui termina a tabela de produtos -->
					
					<div style="float: left; margin-right: 10px; margin-left: 10px;">	
					<p:panel style="width: 580px; height: 190px;">
					
					<h:panelGrid id="parcela_div" columns="10">
					
					<h:outputLabel value="Forma de pagamento" styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 1}" />
            		<p:selectOneMenu style="width: 150px;" id="forma" value="#{vendaBean.venda.formaPagamento}" rendered="#{vendaBean.venda.operacao == 1}"
					styleClass="input" effect="fade">
						<f:selectItem itemLabel="à vista" itemValue="1" />
						<f:selectItem itemLabel="cartão(crédito)" itemValue="2" />
						<f:selectItem itemLabel="cartão(débito)" itemValue="3" />
						<f:selectItem itemLabel="cheque(à vista)" itemValue="4" />
						<f:selectItem itemLabel="cheque(pré datado)" itemValue="5" />
						<f:selectItem itemLabel="depósito bancário" itemValue="6" />
						<f:ajax render="parcela_div" />           			            		
            		</p:selectOneMenu>
            		
            		<h:outputLabel value="Parcelas" styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 1 and vendaBean.venda.formaPagamento == 2}" />
					<h:graphicImage value="/resources/img/as.png" styleClass="as" rendered="#{vendaBean.venda.operacao == 1 and vendaBean.venda.formaPagamento == 2}" />
					<p:spinner id="parcela" value="#{vendaBean.venda.quantidadeParcela}" size="5"
					min="0" max="100" validatorMessage="Parcelas inválida" rendered="#{vendaBean.venda.operacao == 1 and vendaBean.venda.formaPagamento == 2}">
						<f:ajax event="blur" />
						<f:validateLongRange minimum="0" />
					</p:spinner>
					
					<h:outputLabel value="Gerar cupom? " styleClass="OutPut" style="mergin-left: 30px;" rendered="#{vendaBean.venda.operacao == 1}" />
            		<p:selectBooleanCheckbox id="cupom" value="#{vendaBean.venda.imprimeCupom}" rendered="#{vendaBean.venda.operacao == 1}" /> 
										
					</h:panelGrid>
            		
                    <h:panelGrid columns="1">

					<h:outputLabel value="OBS" styleClass="OutPut" style="mergin-left: 30px;" rendered="#{vendaBean.venda.operacao == 1}" />
					<h:outputLabel value="Justificativa" styleClass="OutPut" style="mergin-left: 30px;" rendered="#{vendaBean.venda.operacao == 2}" />
					<p:selectOneMenu style="width: 190px;" id="tituloobs" value="#{vendaBean.venda.tituloObs}" rendered="#{vendaBean.venda.operacao == 1}"
					styleClass="input" effect="fade">
						<f:selectItem itemValue="" itemLabel="" noSelectionOption="true" />
						<f:selectItem itemLabel="Devolução" itemValue="1" />
						<f:selectItem itemLabel="Defeito" itemValue="2" />
						<f:selectItem itemLabel="Doação" itemValue="3" />
						<f:selectItem itemLabel="Roubo" itemValue="4" />
						<f:selectItem itemLabel="Troca" itemValue="5" />
						<f:selectItem itemLabel="Venda com desconto" itemValue="6" />
						<f:selectItem itemLabel="Venda com valor de custo" itemValue="7" />            			            		
            		</p:selectOneMenu>					
					<p:inputTextarea id="obs" value="#{vendaBean.venda.obs}" styleClass="input" maxlength="250" rendered="#{vendaBean.venda.operacao == 1}" />
					<p:inputTextarea id="obs2" value="#{vendaBean.venda.obs}" styleClass="input" maxlength="250" cols="20" rows="4" rendered="#{vendaBean.venda.operacao == 2}"
					required="true" requiredMessage="Para retirada precisa-se de justificativa" />
					<br /><br />
					
					</h:panelGrid>
					
					</p:panel>
					</div>
					
					<div style="float: right; margin-right: 10px; margin-left: 10px;">
<!-- 					modo entrada -->
					<p:panel style="text-align: right; width: 400px; height: 190px;" rendered="#{vendaBean.venda.operacao != 2}">
					 
					<h:panelGrid columns="6" cellpadding="3" cellspacing="3" style="text-align: right; float: right;">
					
					<h:outputLabel value="desconto % " styleClass="OutPut" style="font-size: 14px;" rendered="#{vendaBean.venda.operacao == 1}" />
					<p:spinner id="desconto" value="#{vendaBean.desconto}" size="5"
					min="0" max="100" validatorMessage="Desconto inválido" rendered="#{vendaBean.venda.operacao == 1}">
						<f:ajax event="blur" />
						<f:validateLongRange minimum="0" />
					</p:spinner>
					
					<p:commandButton value="Gerar desconto" action="#{vendaBean.gerarDesconto}" ajax="false" icon="ui-icon-check" rendered="#{vendaBean.venda.operacao == 1}">
						<f:ajax render="@form" event="click" /> 
					</p:commandButton>
										
					</h:panelGrid>	
					<br /><br /><br /><br />
					
					<p:separator width="450" />
					
					<br />
					<p:fieldset style="background: #A6C9E2; border-color: #8B0000; border: 1px solid #8B0000; height: 20px;" styleClass="shadow2" >
					
					<h:outputLabel value="Valor à pagar: " style="font-size: 18px; font-weight: bold; color: #8B0000; line-height: 20px;" styleClass="acende" rendered="#{vendaBean.venda.operacao == 1}" />
					<h:outputLabel value="#{vendaBean.valorTotalComDesconto}" style="font-size: 18px; font-weight: bold; color: #8B0000;" rendered="#{vendaBean.venda.operacao == 1}" >
						<f:convertNumber type="currency" currencySymbol="R$" locale="pt_BR" />
					</h:outputLabel>
										
					</p:fieldset>
					<br />
					
					<p:separator width="450" />
					<br /><br />
					
					<h:outputLabel value="Funcionário: #{loginBean.usuario.nome}" style="float: right; text-align: center; font-weight: bold;" styleClass="OutPut" rendered="#{vendaBean.venda.operacao == 1}" />
            		
            		</p:panel>
            		
<!--             		modo saida -->

					<p:panel style="text-align: right; width: 400px; height: 190px;" rendered="#{vendaBean.venda.operacao == 2}">
					 
					<p:separator width="450" />
					
					<br />
					<p:fieldset style="background: #A6C9E2; border-color: #8B0000; border: 1px solid #8B0000; height: 20px;" styleClass="shadow2" >
					
					<h:outputLabel value="Valor R$: " style="font-size: 14px; float: left; text-align: left; font-weight: bold; color: #8B0000; line-height: 20px;" styleClass="acende" rendered="#{vendaBean.venda.operacao == 2}" />
					<h:inputText value="#{vendaBean.venda.valorTotal}" style="font-size: 15px; float: left; text-align: left; font-weight: bold; color: #8B0000;" 
					rendered="#{vendaBean.venda.operacao == 2}" size="15" required="true" requiredMessage="Informe o valor da retirada" >
						<f:convertNumber locale="pt_BR" pattern="#,##0.00" />
					</h:inputText>
										
					</p:fieldset>
					<br />
					
					<p:separator width="450" />
					<br /><br />
					
					<h:outputLabel value="Funcionário: #{loginBean.usuario.nome}" style="float: right; text-align: center; font-weight: bold;" styleClass="OutPut" rendered="#{vendaBean.venda.operacao != 2}" />
            		
            		</p:panel>
            		
            		<br /><br />
            		</div>
					
										
					</fieldset>										
			
			<div style="background: #C4D2EB; height: 28px;" align="center">
				<p:commandButton action="#{vendaBean.addVendaAdmin}" value="Finalizar Venda" ajax="false" icon="ui-icon-check" update=":form_efetuar_venda:grid" rendered="#{vendaBean.venda.operacao != 2}">
					<f:ajax render="@form" />
				</p:commandButton>
				
				<p:commandButton action="#{vendaBean.addSaida}" value="Efetuar Saída" ajax="false" icon="ui-icon-check" update=":form_efetuar_venda:grid" rendered="#{vendaBean.venda.operacao == 2}">
					<f:ajax render="@form" />
				</p:commandButton>&nbsp;
				
				<p:commandButton action="#{vendaBean.cancelarVenda3}" value="Cancelar Saída" ajax="false" icon="ui-icon-close" immediate="true" style="color: red;"
				rendered="#{vendaBean.venda.cliente.id!=null and vendaBean.venda.operacao == 2}">
					<f:ajax render="@form" />
				</p:commandButton>
									
				<p:commandButton action="#{vendaBean.cancelarVenda3}" value="Cancelar Venda" ajax="false" icon="ui-icon-close" immediate="true" style="color: red;"
				rendered="#{vendaBean.venda.cliente.id!=null and vendaBean.venda.operacao != 2}">
					<f:ajax render="@form" />
				</p:commandButton>
				
				<p:commandButton action="#{vendaBean.cancelarVenda4}" value="Cancelar Saída" ajax="false" icon="ui-icon-close" immediate="true" style="color: red;"
				rendered="#{vendaBean.venda.cliente.id==null and vendaBean.venda.operacao == 2}">
					<f:ajax render="@form" />
				</p:commandButton>
				
					<p:commandButton action="#{vendaBean.cancelarVenda4}" value="Cancelar Venda" ajax="false" icon="ui-icon-close" immediate="true" style="color: red;"
				rendered="#{vendaBean.venda.cliente.id==null and vendaBean.venda.operacao != 2}">
					<f:ajax render="@form" />
				</p:commandButton>
				
			</div><br />
						
			<div align="center" style="float: center; text-align: center;">
				<h:outputLabel value="Os Campos Com " styleClass="OutPut" /><h:graphicImage value="/resources/img/as.png" />
				<h:outputLabel value="São Obrigatórios" styleClass="OutPut" />
			</div>

				<div align="left" style="width: 350px; margin-right: 500px;">
					<p:messages id="mgsg" autoUpdate="true" />
				</div>

			</h:form>								
			
		</div>
		
		<!-- 			Aqui começa o dialog Add Tipo -->
			
			<p:dialog header="Adicionar Tipo de Produto" widgetVar="dlgTipoProduto" resizable="false" modal="true" closable="false" showEffect="fold">
				<h:form id="form_dialog_tipo">
				
				<h:panelGrid id="grid" columns="4">
					  
					<h:outputLabel value="Tipo de Produto" styleClass="OutPut" />
					<h:graphicImage value="/resources/img/as.png" />
					<p:inputText id="tipo_nome" value="#{tipoProdutoBean.tipo.nome}" required="true" requiredMessage="Informe o nome do tipo de produto">
						<f:ajax event="change" />
					</p:inputText>
															
				</h:panelGrid>
					<br />

					<p:commandButton action="#{tipoProdutoBean.addTipoProduto}" value="Cadastrar" ajax="false" icon="ui-icon-check">
						<f:ajax render="@all" />
					</p:commandButton>&nbsp;
					
					<p:commandButton type="reset" value="Cancelar" ajax="false" icon="ui-icon-close" immediate="true">
						<f:ajax render="@all" />
					</p:commandButton>	
							
				</h:form>
				
			</p:dialog>	
			
			<p:dialog header="Adicionar Categoria" widgetVar="dlgCategoria" resizable="false" modal="true" closable="false" showEffect="fold">
				<h:form id="form_dialog_categoria">
				
				<h:panelGrid id="grid" columns="4">
					  
					<h:outputLabel value="Nome" styleClass="OutPut" />
					<h:graphicImage value="/resources/img/as.png" />
					<p:autoComplete id="cate_nome" value="#{categoriaBean.categoria.nome}" completeMethod="#{categoriaBean.autoComplete}" itemValue="#{c}" itemLabel="#{c}"  var="c"
					minQueryLength="1" maxResults="5" converterMessage="Nome inválido" queryDelay="30" 
					required="true" requiredMessage="Informe o nome da categoria">
						<f:ajax event="change" />
					</p:autoComplete>
															
				</h:panelGrid>
					<br />

					<p:commandButton action="#{categoriaBean.addCategoria}" value="Cadastrar" ajax="false" icon="ui-icon-check">
						<f:ajax render="@all" />
					</p:commandButton>&nbsp;
					
					<p:commandButton type="reset" value="Cancelar" ajax="false" icon="ui-icon-close" immediate="true">
						<f:ajax render="@all" />
					</p:commandButton>	
							
				</h:form>
				
			</p:dialog>	
			
<!-- 			Aqui começa o dialog para Editar Produto -->
			
			<p:dialog header="Clientes" 
			widgetVar="dlgCliente" resizable="false" modal="true" showEffect="fold">
				<h:form id="form_dialog_cliente">
					
					<p:dataTable value="#{usuarioBean.clientesCadastrados2}" var="c" id="tb_clientes" paginator="true" rows="20" paginatorPosition="bottom"
					emptyMessage="Não encontrado">
					
						<p:column headerText="Código" filterBy="#{c.id}" filterMatchMode="exact" style="text-align: center;">
							<h:commandLink value="#{c.id}" onclick="dlgCliente.hide()" id="link_codigo" rendered="#{c.id!=1}">
								<f:setPropertyActionListener target="#{vendaBean.venda.cliente}" value="#{c}" />
							</h:commandLink>
							
							<h:commandLink value="#{c.id}" onclick="dlgCliente.hide()" id="link_codigo_id" rendered="#{c.id==1}"
							style="color: red;">
								<f:setPropertyActionListener target="#{vendaBean.venda.cliente}" value="#{c}" />
							</h:commandLink>
						</p:column>	
						
						<p:column headerText="Nome" filterBy="#{c.nome}" filterMatchMode="contains">
							<h:commandLink value="#{c.nome}" onclick="dlgCliente.hide()"
								id="link_codigo2" rendered="#{c.id!=1}">
								<f:setPropertyActionListener target="#{vendaBean.venda.cliente}" value="#{c}" />
							</h:commandLink>
							
							<h:commandLink value="#{c.nome}" onclick="dlgCliente.hide()"
								id="link_codigo_nome2" rendered="#{c.id==1}" style="color: red;">
								<f:setPropertyActionListener target="#{vendaBean.venda.cliente}" value="#{c}" />
							</h:commandLink>
						</p:column>			
					
					</p:dataTable>
				
				
				</h:form>
			</p:dialog>	
			
<!-- 			Aqui começa o dialog para os produtos disponíveis no estoque -->
			<p:dialog header="" widgetVar="dlgEstoque" modal="true"
				width="auto" resizable="false">
				<h:form id="form_itens">
			
			<div style="background: #394674; align-top: center; height: 20px; line-height: 20px; width: auto" align="center" >
				<h:outputText value="PRODUTOS" style="color: white; font-size: 12px;" styleClass="OutPut" />
			</div>

			<fieldset style="border: 1px solid #A6C9E2; border-top: 0; width: 1000px;">
					
					<p:dataTable id="dt" value="#{itemBean.estoque}" var="item"
						emptyMessage="Não encontrado" paginator="true" rows="15" paginatorPosition="bottom"
						rowStyleClass="#{item.produto.quantidadeMinima >= item.quantidadeAtual ? 'even-row2' : 'old-row'}"
						rowIndexVar="rowIx" style="width: 1000px;">
						
						<p:column width="100"
						headerText="isbn/código" filterBy="#{item.produto.isbn}" filterMatchMode="exact" filterMaxLength="13">
							<h:outputText value="#{item.produto.id}" rendered="#{item.produto.isbn==null}" />
							<h:outputText value="#{item.produto.isbn}" rendered="#{item.produto.isbn!=null}" />
						</p:column>

						<p:column headerText="Produto" width="300"
							filterBy="#{item.produto.nome}" filterMatchMode="contains">
							<h:outputText value="#{item.produto.tipo.nome}: "
								rendered="#{item.produto.tipo.id eq 1}" />
							<h:outputText value="#{item.produto.nome}">
								<f:converter converterId="stringLimiterConverter" />
								<f:attribute name="limit" value="40" />
							</h:outputText>
						</p:column>
						
						<p:column headerText="Lote" width="100" style="text-align: center;"
							filterBy="#{item.notaFiscal.lote}" filterMatchMode="exact">
							<h:outputText value="#{item.notaFiscal.lote}" rendered="#{item.notaFiscal.lote!=null}" />
						</p:column>
						
						<p:column headerText="Autor" width="200"
							filterBy="#{item.produto.autor}" filterMatchMode="contains">
							<h:outputText value="#{item.produto.autor}" rendered="#{item.produto.autor!=null}" />
							<h:outputText value="NENHUM" rendered="#{item.produto.autor==null}" />
						</p:column>

						<p:column headerText="qdt Entrada" style="color: #1874CD">
							<h:outputText value="#{item.quantidadeEntrada}" />
						</p:column>

						<p:column headerText="qdt Saida" style="color: #8B0000">
							<h:outputText value="#{item.quantidadeSaida}" />
						</p:column>

						<p:column headerText="qdt Atual" style="color: blue;">
							<h:outputText value="#{item.quantidadeAtual}"
								rendered="#{item.quantidadeAtual > item.produto.quantidadeMinima}" />
							<h:outputText value="(#{item.quantidadeAtual2})"
								style="color: #CD0000;"
								rendered="#{item.produto.quantidadeMinima >= item.quantidadeAtual}" />
						</p:column>

					</p:dataTable>

				</fieldset>	

			</h:form>
			</p:dialog>
			
			<p:dialog rendered="#{loginBean.usuario.id==null}" visible="true" resizable="false" closable="false" modal="true">
				<div align="center">

					<br />
					<p:graphicImage value="/resources/img/noacsses.png" />
					<br />
					<br />
					<br />
					<br /> <a href="javascript:history.back(-1)">Voltar</a><br />

				</div>
			</p:dialog>
	</ui:define>
</ui:composition>
</html>
